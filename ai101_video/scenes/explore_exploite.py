from manim import (
    LEFT,
    RIGHT,
    UP,
    WHITE,
    Circle,
    FadeOut,
    Group,
    GrowArrow,
    SurroundingRectangle,
    Text,
    Transform,
    VGroup,
    Write,
)
from manim.mobject.graphing.coordinate_systems import Arrow
from manim.mobject.svg.brace import Line
from manim.mobject.vector_field import GREEN
from manim.renderer.opengl_renderer import DOWN

from ai101_video.default_voice_scene import DefaultMainVoiceScene
from ai101_video.scenes.utils import img
from ai101_video.text_helper import Text_Helper


class Explore_Exploite(DefaultMainVoiceScene):
    def construct(self):
        title = Text(
            Text_Helper.get_text("Explore_Exploite", "title"), font_size=25
        ).move_to(UP * 3)

        with self.voiceover(
            Text_Helper.get_text("Explore_Exploite", "title_voice_text")
        ):
            self.play(Write(title))

        with self.voiceover(Text_Helper.get_text("Explore_Exploite", "explore")):
            explore_title_pos = LEFT * 4 + UP * 1.5
            explore_text_pos = LEFT * 4
            elf_pos = LEFT * 4 + DOWN * 2

            explore_title = Text(
                Text_Helper.get_text("Explore_Exploite", "explore_title"), font_size=20
            ).move_to(explore_title_pos)

            explore_text = (
                Group(
                    Text(
                        Text_Helper.get_text("Explore_Exploite", "explore_text_1"),
                        font_size=20,
                    ),
                    Text(
                        Text_Helper.get_text("Explore_Exploite", "explore_text_2"),
                        font_size=20,
                    ),
                )
                .arrange(DOWN, buff=0.1)
                .move_to(explore_text_pos)
            )
            explore_box = SurroundingRectangle(explore_text, buff=0.1, color=GREEN)

            self.add(explore_title)
            self.wait(2)
            self.add(explore_text, explore_box)

            self.wait(4)

            elf_1 = img("assets/elf_down.png").scale(6).move_to(elf_pos)
            antenna = VGroup(
                Line(
                    elf_1.get_center(),
                    elf_1.get_center() + 0.5 * UP,
                ).move_to(elf_1.get_center() + UP * 0.5),
                Circle(radius=0.05, color=WHITE, fill_opacity=1).move_to(
                    elf_1.get_center() + UP * 0.7
                ),
            )
            self.add(antenna.set_z_index(-1), elf_1)

            wave = Circle(radius=0.06, color=WHITE, fill_opacity=0).move_to(
                elf_1.get_center() + UP * 0.7
            )
            self.add(wave)

            for _ in range(8):
                save = wave.copy()
                self.play(
                    Transform(save, wave.copy().scale(3)),
                    run_time=1,
                )
                self.remove(save)

        with self.voiceover(Text_Helper.get_text("Explore_Exploite", "exploite")):
            exploite_title_pos = RIGHT * 4 + UP * 1.5
            exploite_text_pos = RIGHT * 4
            elf_pos = RIGHT * 4 + DOWN * 2

            exploite_title = Text(
                Text_Helper.get_text("Explore_Exploite", "exploite_title"), font_size=20
            ).move_to(exploite_title_pos)

            exploite_text = (
                Group(
                    Text(
                        Text_Helper.get_text("Explore_Exploite", "exploite_text_1"),
                        font_size=20,
                    ),
                    Text(
                        Text_Helper.get_text("Explore_Exploite", "exploite_text_2"),
                        font_size=20,
                    ),
                )
                .arrange(DOWN, buff=0.1)
                .move_to(exploite_text_pos)
            )
            exploite_box = SurroundingRectangle(exploite_text, buff=0.1, color=GREEN)

            self.add(exploite_title)
            self.wait(2)
            self.add(exploite_text, exploite_box)

            self.wait(4)

            elf_2 = img("assets/elf_right.png").scale(6).move_to(elf_pos)

            arrow = Arrow(
                start=elf_2.get_center() + RIGHT * 0.3,
                end=elf_2.get_center() + RIGHT * 2,
                color=WHITE,
            )

            self.add(elf_2)
            self.play(GrowArrow(arrow), run_time=1)

        self.play(
            FadeOut(elf_1),
            FadeOut(arrow),
            FadeOut(elf_2),
            FadeOut(antenna),
            FadeOut(wave),
        )

        with self.voiceover(Text_Helper.get_text("Explore_Exploite", "end")):
            tradeoff_title_pos = DOWN * 2
            tradeoff_exploite_text_pos = RIGHT * 4 + DOWN * 3
            tradeoff_explore_text_pos = LEFT * 4 + DOWN * 3

            tradeoff_title = Text(
                Text_Helper.get_text("Explore_Exploite", "tradeoff_title"), font_size=20
            ).move_to(tradeoff_title_pos)

            tradeoff_explore_text = (
                Group(
                    Text(
                        Text_Helper.get_text(
                            "Explore_Exploite", "tradeoff_explore_text"
                        ),
                        font_size=20,
                    ),
                )
                .arrange(RIGHT, buff=0.1)
                .move_to(tradeoff_explore_text_pos)
            )
            tradeoff_explore_box = SurroundingRectangle(
                tradeoff_explore_text, buff=0.1, color=GREEN
            )

            tradeoff_exploite_text = (
                Group(
                    Text(
                        Text_Helper.get_text(
                            "Explore_Exploite", "tradeoff_exploite_text"
                        ),
                        font_size=20,
                    ),
                )
                .arrange(RIGHT, buff=0.1)
                .move_to(tradeoff_exploite_text_pos)
            )
            tradeoff_exploite_box = SurroundingRectangle(
                tradeoff_exploite_text, buff=0.1, color=GREEN
            )

            self.wait(2)

            self.add(tradeoff_title)

            self.wait(1)

            self.add(
                tradeoff_explore_text,
                tradeoff_exploite_text,
                tradeoff_exploite_box,
                tradeoff_explore_box,
            )

            self.wait(4)

            self.play(
                FadeOut(explore_box),
                FadeOut(exploite_box),
                FadeOut(exploite_text),
                FadeOut(explore_text),
                FadeOut(exploite_title),
                FadeOut(explore_title),
            )

            self.play(
                tradeoff_title.animate.move_to(UP * 2),
                tradeoff_exploite_text.animate.move_to(exploite_text_pos + UP * 0.6),
                tradeoff_explore_text.animate.move_to(explore_text_pos + UP * 0.6),
                tradeoff_exploite_box.animate.move_to(exploite_text_pos + UP * 0.6),
                tradeoff_explore_box.animate.move_to(explore_text_pos + UP * 0.6),
            )

            decay_rate_title = Text(
                Text_Helper.get_text("Explore_Exploite", "decay_rate_title"),
                font_size=20,
            ).move_to(DOWN)
            decay_rate_text = (
                Group(
                    Text(
                        Text_Helper.get_text("Explore_Exploite", "decay_rate_text_1"),
                        font_size=20,
                    ),
                    Text(
                        Text_Helper.get_text("Explore_Exploite", "decay_rate_text_2"),
                        font_size=20,
                    ),
                    Text(
                        Text_Helper.get_text("Explore_Exploite", "decay_rate_text_3"),
                        font_size=20,
                    ),
                )
                .arrange(DOWN, buff=0.1)
                .move_to(DOWN * 2)
            )

            decay_rate_box = SurroundingRectangle(
                decay_rate_text, buff=0.1, color=GREEN
            ).move_to(DOWN * 2)

            self.add(decay_rate_title)

            self.wait(2)

            self.add(decay_rate_text, decay_rate_box)
